"use strict";function handleUserError(a){"unauthorized"==a.error?authenticate():"access_denied"==a.error&&window.open("access_denied.html","_self")}function handleError(a,b){b.authorized&&("unauthorized"==a.error?window.open("inactivity.html","_self"):(console.info(a.error),window.open("default_error.html","_self")))}function authenticate(){window.open(SERVER_ADDRESS+"login.jsp","_self")}angular.module("lbClientApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap"]).constant("SERVER_ADDRESS","http://62.44.100.18:8080/lb/").constant("CURRENT_USER_ID",1).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/add-new-activity-type",{templateUrl:"views/add-new-activity-type.html",controller:"ActivityCtrl"}).when("/add-food",{templateUrl:"views/add-food.html",controller:"AddFoodCtrl"}).when("/add-beverage",{templateUrl:"views/add-beverage.html",controller:"AddFoodCtrl"}).when("/user-information",{templateUrl:"views/user-information.html",controller:"UserInfomationCtrl"}).when("/select-food",{templateUrl:"views/select-food.html",controller:"SelectFoodCtrl",resolve:{GetFoodServiceData:["GetFoodService",function(a){return a.getAll()}]}}).when("/select-drink",{templateUrl:"views/select-drink.html",controller:"SelectDrinkCtrl",resolve:{GetDrinksServiceData:["GetDrinksService",function(a){return a.getAll()}]}}).when("/select-activity",{templateUrl:"views/select-activity.html",controller:"SelectActivityCtrl",resolve:{GetActivitiesServiceData:["GetActivitiesService",function(a){return a.getAll()}]}}).when("/main-screen",{templateUrl:"views/main-screen.html",controller:"MainScreenCtrl",resolve:{MainScreenData:["GetMainScreenDataService",function(a){return a.getData()}]}}).when("/main-screen/:date",{templateUrl:"views/main-screen.html",controller:"MainScreenCtrl",resolve:{MainScreenData:["GetMainScreenDataService","$route",function(a,b){function c(){var a=new Date,c=b.current.params.date;if(c){if(!c.match(/20\d\d(0|1)\d(0\d|1\d|2\d|3(0|1))/g))throw new Error("Invalid date provided.");var d=parseInt(c.substr(0,4)),e=parseInt(c.substr(4,2))-1,f=parseInt(c.substr(6,2));a=new Date(d,e,f)}return a}return a.getData(c())}]}}).when("/statistics",{templateUrl:"views/statistics.html",controller:"StatCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("lbClientApp").controller("BaseCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()},a.showSelectionDropdown=function(){$("#selectionDropdown").addClass("open")},a.hideSelectionDropdown=function(){$("#selectionDropdown").removeClass("open")}}]),angular.module("lbClientApp").controller("BaseSelectCtrl",["$scope","$controller",function(a,b){angular.extend(this,b("BaseCtrl",{$scope:a})),this.initialize=function(b){function c(b){var c={selected:!1,data:b,quantity:a.defaultQuantity};return c}a.all=_.map(b.all,c),a.recent=_.map(b.recent,c),a.frequent=_.map(b.frequent,c)},a.isInputValid=!1,a.recent=[],a.all=[],a.frequent=[],a.frequentSelected=function(){a.selectedProvider=a.frequent},a.recentSelected=function(){a.selectedProvider=a.recent},a.allSelected=function(){a.selectedProvider=a.all},a.invalidateInput=function(){var b=a.selectedProvider;if(!b)return void(a.isInputValid=!1);for(var c=0;c<b.length;c++)if(b[c].selected)return void(a.isInputValid=!0);a.isInputValid=!1},a.removeSelection=function(){function b(a){a.selected=!1}_.each(a.all,b),_.each(a.frequent,b),_.each(a.recent,b)},a.doneButtonHandler=function(){a.send(_.chain(a.selectedProvider).filter(function(a){return a.selected}).map(function(b){var c=_.clone(b.data);return c.quantity=b.quantity/a.defaultQuantity,c}).value())},a.$watch("selectedProvider",a.invalidateInput())}]),angular.module("lbClientApp").controller("MainCtrl",["$scope","$controller",function(a,b){angular.extend(this,b("BaseCtrl",{$scope:a}))}]),angular.module("lbClientApp").controller("AddFoodCtrl",["$scope","$controller","AddFoodService",function(a,b,c){angular.extend(this,b("BaseCtrl",{$scope:a})),a.item={type:"food"},a.isFood=function(){return"food"===a.item.type},a.isBeverage=function(){return"beverage"===a.item.type},a.selectFood=function(){a.item.type="food"},a.selectBeverage=function(){a.item.type="beverage"},a.quantityLabel=function(){return"food"===a.item.type?"grams":"milliliters"},a.isInputValid=function(){function b(a){return a>=0&&100>=a}var c=a.item,d=parseInt(c.fats),e=parseInt(c.carbohydrates),f=parseInt(c.proteins);return c.name&&$.isNumeric(c.calories)&&$.isNumeric(c.fats)&&b(d)&&$.isNumeric(c.carbohydrates)&&b(e)&&$.isNumeric(c.proteins)&&b(f)&&100>=d+e+f},a.sendItem=function(){function b(){a.item={type:d.type}}var d=a.item;a.isFood()?c.addFood(d.name,d.calories,d.carbohydrates,d.fats,d.proteins,b):c.addBeverage(d.name,d.calories,d.carbohydrates,d.fats,d.proteins,b)}}]),angular.module("lbClientApp").controller("ActivityCtrl",["$scope","$controller","ActivityService",function(a,b,c){angular.extend(this,b("BaseCtrl",{$scope:a})),a.insertActivity=function(){var b=a.newActivity.name,d=a.newActivity.calories;c.insertActivity(b,d),a.newActivity.name="",a.newActivity.calories={lightly:"",moderate:"",veryActive:""}}}]),angular.module("lbClientApp").service("GetFoodService",["$http","SERVER_ADDRESS","$q","CURRENT_USER_ID",function(a,b,c,d){this.getAll=function(){function e(){h>=3&&f.resolve(g)}var f=c.defer(),g={},h=0;return a.get(b+"meals/list").success(function(a){h++,g.all=a,e()}),a.get(b+"meals/list/recent/"+d).success(function(a){h++,g.recent=a,e()}),a.get(b+"meals/list/frequent/"+d).success(function(a){h++,g.frequent=a,e()}),f.promise}}]),angular.module("lbClientApp").service("GetActivitiesService",["$http","SERVER_ADDRESS","$q","CURRENT_USER_ID",function(a,b,c,d){this.getAll=function(){function e(){h>=3&&f.resolve(g)}var f=c.defer(),g={},h=0;return a.get(b+"activities/list").success(function(a){h++,g.all=a,e()}),a.get(b+"activities/list/recent/"+d).success(function(a){h++,g.recent=a,e()}),a.get(b+"activities/list/frequent/"+d).success(function(a){h++,g.frequent=a,e()}),f.promise}}]),angular.module("lbClientApp").service("GetDrinksService",["$http","SERVER_ADDRESS","$q","CURRENT_USER_ID",function(a,b,c,d){this.getAll=function(){function e(){h>=3&&f.resolve(g)}var f=c.defer(),g={},h=0;return a.get(b+"drinks/list").success(function(a){h++,g.all=a,e()}),a.get(b+"drinks/list/recent/"+d).success(function(a){h++,g.recent=a,e()}),a.get(b+"drinks/list/frequent/"+d).success(function(a){h++,g.frequent=a,e()}),f.promise}}]),angular.module("lbClientApp").service("GetMainScreenDataService",["$http","SERVER_ADDRESS","$q","CURRENT_USER_ID",function(a,b,c,d){this.getData=function(e){var f=c.defer(),g=e?e:new Date,h=b+"mainScreen/"+d+"/"+g.getFullYear()+"/"+(g.getMonth()+1)+"/"+g.getDate();return a.get(h).success(function(a){a.a=!0;var b=a.caloriesConsumed,c=a.caloriesBurned,d=a.caloriesRemaining,e=c/2e3*100;f.resolve({timestamp:g.getTime(),caloriesConsumed:b,caloriesBurned:c,caloriesRemaining:d,minutesExercised:a.minutesExercised,progress:e})}),f.promise}}]),angular.module("lbClientApp").service("ActivityService",["$http","$q","SERVER_ADDRESS",function(a,b,c){this.getAllActivities=function(){},this.insertActivity=function(d,e){var f={name:d,type:"",caloriesPerHour:""},g=[];angular.forEach(e,function(b,d){f.type=d,f.caloriesPerHour=b,g.push(a({method:"POST",url:c+"activities/insert-new-type",contentType:"application/json",data:angular.copy(JSON.stringify(f))}))}),b.all(g).then(function(a){console.log("OK message: ",a)},function(a){console.log("NOT OK message",a)})}}]),angular.module("lbClientApp").service("AddFoodService",["$http","SERVER_ADDRESS",function(a,b){function c(a,b,c,d,e){return{name:a,fat:d,calories:b,carbohydrates:c,proteins:e,type:"foo"}}this.addFood=function(d,e,f,g,h,i){var j=c(d,e,f,g,h);a({method:"POST",url:b+"meals/insert",contentType:"application/json",data:JSON.stringify(j)}).success(function(a){console.log(a),i.call()}).error(function(a){console.log(a),handleUserError(a)})},this.addBeverage=function(d,e,f,g,h,i){var j=c(d,e,f,g,h);a({method:"POST",url:b+"drinks/insert",contentType:"application/json",data:JSON.stringify(j)}).success(function(a){console.log(a),i.call()}).error(function(a){console.log(a),handleUserError(a)})}}]),angular.module("lbClientApp").service("SelectActivitiesService",["$http","SERVER_ADDRESS","CURRENT_USER_ID",function(a,b,c){this.selectActivities=function(d,e){var f=_.map(d,function(a){return{id:a.id,quantity:a.quantity}});a({method:"POST",url:b+"activities/"+c,contentType:"application/json",data:JSON.stringify(f)}).success(function(a){e&&e.call(),console.log(status,a)}).error(function(a){console.log(a)})}}]),angular.module("lbClientApp").service("SelectDrinksService",["$http","SERVER_ADDRESS","CURRENT_USER_ID",function(a,b,c){this.selectDrinks=function(d,e){var f=_.map(d,function(a){return{id:a.id,quantity:a.quantity}});a({method:"POST",url:b+"drinks/"+c,contentType:"application/json",data:JSON.stringify(f)}).success(function(a){e&&e.call(),console.log(status,a)}).error(function(a){console.log(a)})}}]),angular.module("lbClientApp").service("SelectFoodsService",["$http","SERVER_ADDRESS","CURRENT_USER_ID",function(a,b,c){this.selectFoods=function(d,e){var f=_.map(d,function(a){return{id:a.id,quantity:a.quantity}});a({method:"POST",url:b+"meals/"+c,contentType:"application/json",data:JSON.stringify(f)}).success(function(a){e&&e.call(),console.log(status,a)}).error(function(a){console.log(a)})}}]),angular.module("lbClientApp").controller("SelectFoodCtrl",["$scope","$controller","GetFoodServiceData","SelectFoodsService",function(a,b,c,d){angular.extend(this,b("BaseSelectCtrl",{$scope:a})),a.quantityLabel="Quantity (grams)",a.defaultQuantity=100,this.initialize(c),a.send=function(b){d.selectFoods(b,a.removeSelection)}}]),angular.module("lbClientApp").controller("SelectDrinkCtrl",["$scope","$controller","GetDrinksServiceData","SelectDrinksService",function(a,b,c,d){angular.extend(this,b("BaseSelectCtrl",{$scope:a})),a.quantityLabel="Quantity (milliliters)",a.defaultQuantity=100,this.initialize(c),a.send=function(b){d.selectDrinks(b,a.removeSelection)}}]),angular.module("lbClientApp").controller("SelectActivityCtrl",["$scope","$controller","GetActivitiesServiceData","SelectActivitiesService",function(a,b,c,d){angular.extend(this,b("BaseSelectCtrl",{$scope:a})),a.quantityText="Duration (hours)",a.defaultQuantity=1,this.initialize(c),a.send=function(b){d.selectActivities(b,a.removeSelection)}}]),angular.module("lbClientApp").controller("UserInfomationCtrl",["$scope","$controller","$location","SetUserDetailsService",function(a,b,c,d){angular.extend(this,b("BaseCtrl",{$scope:a})),a.personBornDate="",a.personHeight="",a.personWeight="",a.personMetabolism=0,a.personSex=0,a.personGoal=0,a.personCalories=0,a.goalDate="mm/dd/yyyy",a.personGoalKG=0,a.personGoalDays=0,a.personBornDate="mm/dd/yyyy",a.firstName="",a.middleName="",a.lastName="",a.submitUserDetails=function(){d.setUserDetails(a.firstName,a.middleName,a.lastName,a.personBornDate,a.personHeight,a.personWeight),a.firstName="",a.middleName="",a.lastName="",a.personBornDate="mm/dd/yyyy",a.personHeight="",a.personWeight="",c.path("/")},a.getDaysBetweenGoalAndToday=function(){var b=Math.floor((new Date(a.goalDate)-new Date)/864e5)+1;return console.log("result",typeof b),b},a.getYearsBetweenDates=function(){var b=new Date,c=new Date(a.personBornDate),d=Math.abs(b-c),e=31558464e3;return d/e},a.calculateCaloriesPerDay=function(){return"male"===a.personSex&&(a.personCalories=655+9.6*a.personWeight+1.8*a.personHeight-4.7*a.getYearsBetweenDates(),a.personCalories=Math.round(100*a.personCalories)/100),"female"===a.personSex&&(a.personCalories=66+13.7*a.personWeight+5*a.personHeight-6.8*a.getYearsBetweenDates(),a.personCalories=Math.round(100*a.personCalories)/100),a.personGoal&&a.personGoalKG&&a.getDaysBetweenGoalAndToday()>0&&("male"===a.personSex&&(a.personCalories=Math.abs(a.personGoalKG-a.personWeight)*(3500-a.personHeight-15*a.personMetabolism)/a.getDaysBetweenGoalAndToday(),a.personCalories=Math.round(100*a.personCalories)/100),"female"===a.personSex&&(a.personCalories=Math.abs(a.personGoalKG-a.personWeight)*(3e3-a.personHeight-10*a.personMetabolism)/a.getDaysBetweenGoalAndToday(),a.personCalories=Math.round(100*a.personCalories)/100)),!0}}]),angular.module("lbClientApp").controller("StatCtrl",["$scope","$controller","$http","$rootScope","SERVER_ADDRESS",function(a,b){angular.extend(this,b("BaseCtrl",{$scope:a}));var c=[{id:"dayli",name:"Daily Statistics",num:"1"},{id:"weekly",name:"Weekly Statistics",num:"2"},{id:"mothly",name:"Mothly Statistics",num:"3"},{id:"yearly",name:"Yearly Statistics",num:"4"}];a.cases=c,a.current_case=c[0],a.dailyPressed=function(){a.current_case=c[0]},a.weeklyPressed=function(){a.current_case=c[1]},a.mothlyPressed=function(){a.current_case=c[2]},a.yearlyPressed=function(){a.current_case=c[3]}}]),angular.module("lbClientApp").service("SetUserDetailsService",["$http","SERVER_ADDRESS",function(a,b){this.setUserDetails=function(c,d,e,f,g,h){var i={firstname:c,middlename:d,lastname:e,dateOfBirth:new Date(f),height:g,weight:h};a({method:"POST",url:b+"persons/setdetails",contentType:"application/json",data:JSON.stringify(i)}).success(function(a){console.log(status,a)}).error(function(a){console.log(a)})}}]),angular.module("lbClientApp").controller("MainScreenCtrl",["$scope","$controller","$location","$filter","MainScreenData",function(a,b,c,d,e){function f(b){a.progressBarStyle={width:b+"%"}}angular.extend(this,b("BaseCtrl",{$scope:a})),a.showPicker=!1,a.today=new Date,a.selectedDate=new Date(e.timestamp),a.$watch("selectedDate",function(b,e){e&&b&&b.getTime()!==e.getTime()&&(a.showPicker=!1,setTimeout(function(){c.path("main-screen/"+d("date")(b,"yyyyMMdd"))},200))},!0),f(e.progress),a.targetTimestamp=e.timestamp,a.caloriesConsumed=e.caloriesConsumed,a.caloriesBurned=e.caloriesBurned,a.caloriesRemaining=Math.max(0,e.caloriesRemaining),a.minutesExercised=e.minutesExercised}]);